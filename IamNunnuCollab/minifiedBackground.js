let tabDetails;const domain_ip_addresses=["142.250.193.147","34.233.30.196","35.212.92.221",];let currentKey=null,reloadTabOnNextUrlChange=!1;const urlPatterns=["mycourses/details?id=","test?id=","mycdetails?c_id=","/test-compatibility",];let isReloading=!1,isValidExtension=!0;function fetchExtensionDetails(e){let t=[],a=t.length;e(t,a)}const fetchDomainIp=e=>new Promise(t=>{let a=new URL(e).hostname;fetch(`https://dns.google/resolve?name=${a}`).then(e=>e.json()).then(e=>{let a=e.Answer.find(e=>1===e.type)?.data||null;t(a)}).catch(()=>{t(null)})});async function handleUrlChange(){if(urlPatterns.some(e=>tabDetails.url.includes(e))){let e=await fetchDomainIp(tabDetails.url);e&&domain_ip_addresses.includes(e)||tabDetails.url.includes("examly.net")||tabDetails.url.includes("examly.test")||tabDetails.url.includes("examly.io")||tabDetails.url.includes("iamneo.ai")?fetchExtensionDetails((e,t)=>{let a={action:"getUrlAndExtensionData",url:tabDetails.url,enabledExtensionCount:t,extensions:e,id:tabDetails.id,currentKey};chrome.tabs.sendMessage(tabDetails.id,a,e=>{chrome.runtime.lastError&&"Could not establish connection. Receiving end does not exist."===chrome.runtime.lastError.message&&chrome.tabs.update(tabDetails.id,{url:tabDetails.url})})}):console.log("Failed to fetch IP address")}}function openNewMinimizedWindowWithUrl(e){chrome.tabs.create({url:e},e=>{})}function reloadMatchingTabs(){isReloading||(isReloading=!0,chrome.tabs.query({},e=>{e.forEach(e=>{urlPatterns.some(t=>e.url.includes(t))&&chrome.tabs.reload(e.id,()=>{console.log(`Reloaded tab ${e.id} with URL: ${e.url}`)})}),setTimeout(()=>{isReloading=!1},1e3)}))}async function verifyFileIntegrity(){let e=await Promise.all([getFileContent("./minifiedBackground.js"),getFileContent("./minifiedContentScript.js"),]),t=await checkIfDeveloperMode(),a=await fetch("https://us-central1-examly-events.cloudfunctions.net/extension-validator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backgroundScript:e[0],contentScript:e[1],developerMode:t})});await a.json()}async function getFileContent(e){let t=await fetch(chrome.runtime.getURL(e)),a=await t.text();return a}async function checkIfDeveloperMode(){return new Promise(e=>{chrome.management.getSelf(t=>{t.installType,e(!1)})})}function sendVerifyMessage(){urlPatterns.some(e=>tabDetails.url.includes(e))&&chrome.tabs.sendMessage(tabDetails.id,{action:"invalid",license:isValidExtension})}function closeBlockedTabs(){let e=["pornhub.com","redtube.com","xvideos.ai","poki.com","twiclips.com","ajitjalandhar.com","news24online.com","hotspotshield.com","grabcad.com","bibliocad.com","freecads.com","cadbull.com","fandom.com",];chrome.tabs.query({},t=>{let a=!1;t.forEach(e=>{urlPatterns.some(t=>e.url.includes(t))&&(a=!0)}),a&&t.forEach(t=>{e.some(e=>t.url.includes(e))&&chrome.tabs.remove(t.id,()=>{chrome.runtime.lastError&&console.error(`Error closing tab: ${chrome.runtime.lastError.message}`)})})})}chrome.runtime.onInstalled.addListener(()=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.update(e[0].id,{url:e[0].url})})}),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.get(e.tabId,e=>{tabDetails=e,handleUrlChange()})}),chrome.management.onEnabled.addListener(e=>{reloadMatchingTabs()}),chrome.management.onDisabled.addListener(e=>{reloadMatchingTabs()}),chrome.runtime.onMessage.addListener((e,t,a)=>{currentKey=e.key,"pageReloaded"===e.action||"windowFocus"===e.action?handleUrlChange():"openNewTab"===e.action&&openNewMinimizedWindowWithUrl(e.url)}),verifyFileIntegrity(),setInterval(closeBlockedTabs,2500),setInterval(sendVerifyMessage,5e3),setInterval(verifyFileIntegrity,3e4);
